<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Performance por Página (Lighthouse)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:system-ui, sans-serif; margin:24px}
    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:24px}
    .card{border:1px solid #eee; border-radius:12px; padding:16px; text-align:center}
    .title{font-weight:600; margin-bottom:8px; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    canvas{max-width:180px; max-height:180px; margin:0 auto}
  </style>
</head>
<body>
  <h1>⚡ Performance por Página</h1>
  <div id="grid" class="grid"></div>

  <script>
    const GREEN="#2ecc71", YELLOW="#f1c40f", RED="#e74c3c", GREY="#e5e7eb";
    const colorScore = v => v>=90?GREEN : v>=50?YELLOW : RED;

    // Plugin p/ texto no centro do donut
    const centerText = {
      id: "centerText",
      afterDraw(chart,args,opts){
        const {ctx, chartArea:{width,height}} = chart;
        const meta = chart.getDatasetMeta(0);
        if(!meta || !meta.data || !meta.data[0]) return;
        const val = chart.data.datasets[0].data[0]; // score
        ctx.save();
        ctx.font = "600 22px system-ui";
        ctx.fillStyle = "#111";
        ctx.textAlign="center";
        ctx.textBaseline="middle";
        ctx.fillText(Math.round(val), chart.width/2, chart.height/2);
        ctx.restore();
      }
    };

    async function run(){
      const res = await fetch("./lh-summary.json");
      const data = await res.json();

      const grid = document.getElementById("grid");

      data.forEach(d=>{
        const score = Math.round(d.performance ?? 0);
        const card = document.createElement("div");
        card.className="card";
        card.innerHTML = `
          <div class="title" title="${d.page}">${d.page}</div>
          <canvas></canvas>
        `;
        grid.appendChild(card);

        const ctx = card.querySelector("canvas").getContext("2d");
        new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: ["Score","Restante"],
            datasets: [{
              data: [score, 100-score],
              backgroundColor: [colorScore(score), GREY],
              borderWidth: 0
            }]
          },
          options: {
            responsive:true,
            cutout: "70%",
            plugins: { legend: { display:false }, tooltip:{enabled:false} }
          },
          plugins:[centerText]
        });
      });
    }
    run();
  </script>
</body>
</html>
